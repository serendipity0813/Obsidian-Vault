
### 옵저버 패턴

사실 옵저버 패턴은 이미 많이 활용해보셨습니다.

예를 들어, Input System에서 버튼을 누르면 특정한 함수가 실행되도록 구현한다든지, 어떤 값이 변경될 경우에 특정한 이벤트가 발생한다든지 하는 식입니다.

옵저버 패턴은 이벤트를 특정한 오브젝트가 발생시킬 경우 이를 구독하는 구독자들의 함수를 실행시키게 하는 패턴을 말합니다. 이때, 발행자와 구독자의 관계에 따라, 아래와 같이 나타낼 수 있습니다.

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/83c75a39-3aba-4ba4-a792-7aefe4b07895/aeea8c06-20b6-4c3b-b7ca-bf1d0f952f6f/Untitled.png)

옵저버 패턴은 발행자가 1명일때, 구독자가 N명인 방식으로, HP바가 감소했을 때 HP바에 대한 UI처리, 승리/패배 처리 등을 같이 해야 할 때 이런 방식을 생각해볼 수 있습니다.

- 예시 1
    
    ```csharp
    public abstract class Observer
    {
        // 상태 update 메서드
        public abstract void OnNotify();
    }
    // =================================
    
    // 옵저버 구현클래스
    public class ConcreteObserver1 : Observer
    {
        // 대상타입의 클래스에서 이 메소드를 실행시킴
        public override void OnNotify()
        {
            Debug.Log("옵저버 클래스의 메서드 실행 #1");
        }
    }
    // =================================
    
    public interface ISubject
    {
        void AddObserver(Observer o);
        void RemoveObserver(Observer o);
        void Notify();
    }
    
    // =================================
    
    // 대상 클래스
    // : 대상 인터페이스를 구현한 클래스
    public class ConcreteSubject : MonoBehaviour, ISubject
    {
        List<Observer> observers = new List<Observer>();  // 옵저버를 관리하는 List
    
        // 관리할 옵저버를 등록
        public void AddObserver(Observer observer)
        {
            observers.Add(observer);
        }
    
        // 관리중인 옵저버를 삭제
        public void RemoveObserver(Observer observer)
        {
            if (observers.IndexOf(observer) > 0) observers.Remove(observer);
        }
    
        // 관리중인 옵저버에게 연락
        public void Notify()
        {
    				foreach (Observer o in observers)
    				{
    					o.OnNotify();
    				}
        }
    
        void Start()
        {
            Observer obj1 = new ConcreteObserver1();
    
            AddObserver(obj1);
        }
    }
    ```
    
- 예시 2 - event 활용
    
    ```csharp
    public class PlayerCharacter : MonoBehaviour
    	{
    	    public event Action<Enemy> OnAttack; // 이벤트 선언
    
    	    public void Attack(Enemy enemy)
    	    {
    	        // 공격 동작 수행
    	        // ...
    
    	        // 이벤트 호출
    	        OnAttack?.Invoke(enemy);
    	    }
    	}
    
    	public class Enemy : MonoBehaviour
    	{
    	    private void Start()
    	    {
    	        PlayerCharacter player = FindObjectOfType<PlayerCharacter>();
    	        player.OnAttack += ReactToAttack; // 옵저버 등록
    	    }
    
    	    private void ReactToAttack(Enemy enemy)
    	    {
    	        // 공격에 대한 반응 구현
    	        // ...
    	    }
    	}
    
    public class PlayerHealth : MonoBehaviour
    {
        public Text healthText;
    
        private int health = 100;
    
        private void Start()
        {
            UpdateUI();
        }
    
        public void TakeDamage(int damage)
        {
            health -= damage;
            UpdateUI();
        }
    
        private void UpdateUI()
        {
            healthText.text = "Health: " + health.ToString();
        }
    }
    
    public class Explosion : MonoBehaviour
    {
        public delegate void ExplosionEventHandler();
        public static event ExplosionEventHandler OnExplode; // 이벤트 선언
    
        private void Start()
        {
            Explode();
        }
    
        private void Explode()
        {
            // 폭발 동작 수행
            // ...
    
            // 이벤트 호출
            OnExplode?.Invoke();
        }
    }
    
    public class PlayerController : MonoBehaviour
    {
        private void Start()
        {
            // 이벤트 핸들러 등록
            Explosion.OnExplode += PlayExplosionSound;
        }
    
        private void PlayExplosionSound()
        {
            // 폭발 사운드 재생
            // ...
        }
    }
    ```
    